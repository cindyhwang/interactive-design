Enabler.setExpandingPixelOffsets(	0, // left offset of expanded ad	0, // top offset of expanded ad	970, // expanded width of ad	415); // expanded height of ad/* DEFINE GLOBAL VARIABLES */// #collapsed_wrappervar collapsed_container;// #expanded_wrappervar expanded_container;// determine whether pushdown is collapsed or expandedvar pushdown_state = 'collapsed';// boolean value to determine if mousing over is on or offvar collapsed_mouseenter = false;// counter that determines whether to expand creativevar collapse_counter;// #close_button will collapse expanded statevar close_btn;// boolean to determine whether the creative expanded yetvar expanded_generated = false;// pixel width of the poster imagesvar poster_width = 520;// pixel width of thumb imagesvar thumb_width = 95;var thumb_sliding = false;// timer used to calculate how much time to pass between autoslidingvar carousel_timer;// boolean to determine if carousel image is currently sliding or standing stillvar carousel_sliding = false;// container to hold json data related to the carousel articlesvar json_articles;// number of total articles within the json articles datavar total_articles;function request_articles() {	//console.log('fetching data');    var url = '//static.mvdigitalmedia.com/fastcompany/hp/2014/healthcare_issue/970x90/articles.js';	$.ajax({		type: 'GET',		url: url,		async: false,		dataType: 'jsonp',		jsonp: false,		jsonpCallback: 'jsonCallback',		contentType: 'application/json',		cache: true,		success: function(json_data) {			json_articles = json_data.articles;			add_stylesheet(json_data);		},		error: function(e) {			//console.log(e.message);		}	});}function add_stylesheet(json_data) {    $('head').append('<link rel="stylesheet" href="' + json_data.stylesheets.stylesheet_url + '" type="text/css" />');}function reset_expanded() {	//console.log('reset expanded');	clearTimeout(carousel_timer);}collapsed_instances = function() {	collapsed_container = $('#collapsed_wrapper');	expanded_container = $('#expanded_wrapper');};//Add Event Listenersfunction collapsed_listeners() {	collapsed_container.on('mouseenter.pushdown', function(){		on_collapse_mouseover();	});	collapsed_mouseenter = true;	collapsed_container.on('mouseleave.pushdown', function(){		//console.log('pushdown state: ' + pushdown_state + ' and collapsed_mouseenter: ' + collapsed_mouseenter);		if (pushdown_state == 'collapsed' && collapsed_mouseenter === true) {			//console.log('mouse left collapsed state');			on_collapse_mouseout();		}		else if (pushdown_state == 'collapsed' && collapsed_mouseenter === false) {			collapsed_container.on('mouseenter.pushdown', function(){				on_collapse_mouseover();			});			//console.log('setting collapsed mouse enter to true');			collapsed_mouseenter = true;		}	});	collapsed_container.on('click', function(){		on_collapse_click();	});}function disable_collapsed_listeners () {	//console.log('disabling listeners');	collapsed_container.off('mouseenter.pushdown');	collapsed_mouseenter = false;}function on_collapse_click (){	//console.log('mouse over');	clearTimeout(collapse_counter);	on_expand_handler();}function on_collapse_mouseover(){	//console.log('mouse over');	collapse_counter = setTimeout(function(){		on_expand_handler();	},1000);}function on_collapse_mouseout(){	//console.log('mouse out');	clearTimeout(collapse_counter);}function on_close_click_handler(e){	if ( $('video').length > 0 ) {		$('video').get(0).pause();	}	Enabler.requestCollapse();}function on_expand_handler(e){	init_expanded_container();	Enabler.requestExpand();}function init_expanded_container() {	if (expanded_generated === false) {		generate_expanded();		expanded_generated = true;	}	//set variables	close_btn = document.getElementById('close_button');	//define listeners	close_btn.addEventListener('click',on_close_click_handler, false);}function generate_expanded() {	var image_holder = document.getElementById('image_holder');	var thumb_holder = document.getElementById('thumb_holder');	//console.log(json_articles.articles.length);	//LOOP THROUGH JSON OBJECT	total_articles = json_articles.length;	//console.log('total articles' + total_articles);	var image_holder_width = ((total_articles * poster_width) + poster_width);	var thumb_holder_width = ((total_articles * thumb_width) + thumb_width);	$(image_holder).css({'width':image_holder_width ,'left':'0px'});	$(thumb_holder).css({'width':thumb_holder_width ,'left':'0px'});	var thumb_size_class = null;	if (total_articles > 5) {		//console.log('add in the arrows');		$('#thumb_wrapper').css('width','472');		thumb_size_class = 'thumb_small';		$('.thumb_arrow').removeClass('hidden');	}	else {		thumb_size_class = 'thumb_large';	}	for (i=0; i<total_articles; i++) {		if ( json_articles[i].article_type == 'article' ) {			image_holder.innerHTML +=			'<div class="slide-wrapper" data-exit-name="' + json_articles[i].article_exit_name + '" data-type="' + json_articles[i].article_type + '" data-number="' + i + '" style="background-image:url(\'' + json_articles[i].article_image + '\')">' +'</div>';		}		else if ( json_articles[i].article_type == 'video' ) {			//console.log('video article');			image_holder.innerHTML +=			'<div class="slide-wrapper" data-exit-name="' + json_articles[i].article_exit_name + '" data-type="' + json_articles[i].article_type + '" data-number="' + i + '" data-state="stopped" style="background-image:url(\'' + json_articles[i].article_image + '\')">' +				'<video id="video_' + i + '" class="video_container hidden" controls="controls" preload="none">' +					'<source type="video/mp4" src="' + json_articles[i].video_mp4 + '" />' +					'<source type="video/ogg" src="' + json_articles[i].video_ogv + '" />' +					'<source type="video/webm" src="' + json_articles[i].video_webm + '" />' +				'</video>' +			'</div>';		}        thumb_holder.innerHTML +=        '<img class="thumb_image ' + thumb_size_class + '" data-position="'+ (i) +'" src="' + json_articles[i].article_image + '"/>';		//console.log(json_articles[i].poster_image);		//console.log(json_articles[i].article_caption_header);		//console.log(json_articles[i].article_caption_text);		//console.log(json_articles[i].article_exit_url);		//console.log(json_articles[i].image_thumb);		//console.log(' ');	}	//ADD FIRST ARTICLE TO THE END	$( '.slide-wrapper' ).first().clone().appendTo('#image_holder');	//ADD FIRST THUMB TO THE END	//$( '#thumb_holder img' ).first().clone().appendTo('#thumb_holder');	/*		image_holder.innerHTML +=		'<div class="slide-wrapper" data-exit="' + json_articles[0].article_exit_url + '" data-type="' + json_articles[0].article_type + '" data-number="0" style="background-image:url(\'' + json_articles[0].poster_image + '\')">' +            '<div class="image_overlay">' +                '<h1>' + json_articles[0].article_caption_header + '</h1>' +                '<p>' + json_articles[0].article_caption_text + '</p>' +            '</div>' +        '</div>';        */	//console.log(json_articles.articles);	//console.log(json_articles.articles.article_1.image_thumb);	add_expanded_listeners();}function add_expanded_listeners() {	var image_holder_width = parseFloat( $(image_holder).css('width') );	var arrows = $("#arrows");	var thumb_holder = $('#thumb_holder');	var thumb_timer;	var video_playing = false;	$("#slideshow_wrapper")	.mouseover(function() {		if (video_playing === false) {			arrows.removeClass('hidden');		}	})	.mouseout(function() {		arrows.addClass('hidden');	});	$('#poster_arrow_left').click(function() {		//console.log('clicked left arrow');		clearTimeout(carousel_timer);		slide_right();	});	$('#poster_arrow_right').click(function() {		//console.log('clicked right arrow');		clearTimeout(carousel_timer);		slide_left();	});/*	$('#thumb_arrow_left').mousedown(function() {		thumb_slide_left();	});	$('#thumb_arrow_right').mousedown(function() {		thumb_slide_right();	});*/	$("#thumb_arrow_left").on({		mouseover: function () {			thumb_scroll_left();		},		mouseout: function () {			thumb_stop_scroll();		}	});	$("#thumb_arrow_right").on({		mouseover: function () {			thumb_scroll_right();		},		mouseout: function () {			thumb_stop_scroll();		}	});	$(document).mouseup(function(){		//console.log('stop timer');		clearInterval(thumb_timer);		//return false;	});	$('#thumb_wrapper').on('click','.thumb_image',function(e) {		//console.log('clicked a thumb');		//console.log($(this).attr('data-position'));		e.stopPropagation();		if($('video').length > 0) {			$('video').get(0).pause();			$('.image_overlay').removeClass('hidden');			$('.video_container').addClass('hidden');			$('.slide-wrapper[data-state!="stopped"]').attr('data-state','stopped');			video_playing = false;		}		clearTimeout(carousel_timer);		if (carousel_sliding === false) {			carousel_sliding = true;			var slide_position = $(this).attr('data-position') * poster_width;			$(image_holder).animate({ left : -(slide_position) }, 500, function() {				carousel_sliding = false;				check_active_slide();			});		}	});	$('.slide-wrapper').click(function() {		//console.log('clicked a slide wrapper');		//console.log('data url: ' + $(this).attr('data-exit'));		var article_type = $(this).attr('data-type');		//console.log(article_type);		if (article_type == 'article') {            var exit_name = $(this).attr('data-exit-name');			Enabler.exit(exit_name);			Enabler.requestCollapse();		}		else if (article_type == 'video') {			clearTimeout(carousel_timer);			var video_state = $(this).attr('data-state');			//console.log('video_state: ' + video_state);			if (video_state == 'stopped') {				//console.log('show video');				$(this).attr('data-state', 'playing');				$(this).children('.video_container').removeClass('hidden');				$(this).children('.image_overlay').addClass('hidden');				$(this).children('.video_container').get(0).play();				video_playing = true;			}		}	});	$('#background_exit').click(function() {		dc_exit('background');	});	$('#carousel_header').click(function() {		dc_exit('carousel_header');	});	$('#exit_more_stories').click(function() {		dc_exit('more stories');	});    $('#pushdown_wrapper').on('click', '.video_container', function (e) {        var click_position_y = (e.pageY - $(this).offset().top);        var video_height = $(this).height();        //console.log('position y: ' + click_position_y);        var click_percent = (0.8 * video_height);        if ( click_position_y < click_percent ) {            //console.log('exit the video');            pause_videos();            e.stopPropagation();            var video_exit_name = $(this).parent().attr('data-exit-name');            Enabler.exit('video', video_exit);        }    });	function dc_exit(exit_name) {		pause_videos();		if (exit_name == 'background') {			Enabler.exit('background');		}		else if (exit_name == 'carousel_header') {			Enabler.exit('carousel_header');		}		else if (exit_name == 'more stories') {			Enabler.exit('more stories');		}		Enabler.requestCollapse();	}	function start_carousel() {		carousel_timer = setTimeout(function(){			//console.log('auto slide');			slide_left();			start_carousel();		},4000);	}	function slide_right() {		if (carousel_sliding === false) {			carousel_sliding = true;			var image_holder_position = parseFloat( $(image_holder).css('left') );			//console.log( $(image_holder).css('left') );			if( image_holder_position !== 0 ) {				$(image_holder).animate({ left : (image_holder_position + poster_width) }, 500, function() {					carousel_sliding = false;					check_active_slide();				});			}			else {				//console.log('reset position and slide');				$(image_holder).css('left', -(image_holder_width - poster_width)+'px');				$(image_holder).animate({ left : -(image_holder_width - (poster_width * 2)) }, 500, function() {					carousel_sliding = false;					check_active_slide();				});			}		}	}	function slide_left() {		if (carousel_sliding === false) {			carousel_sliding = true;			var image_holder_position = parseFloat( $(image_holder).css('left') );			//console.log(image_holder_position);			if( image_holder_position > -(image_holder_width - poster_width) ) {				$(image_holder).animate({ left : (image_holder_position - poster_width) + 'px' }, 500, function() {					carousel_sliding = false;					check_active_slide();				});			}			else {				$(image_holder).css('left','0px');				$(image_holder).animate({ left : -(poster_width) + 'px' }, 500, function() {					carousel_sliding = false;					check_active_slide();				});			}		}	}	function thumb_scroll_left() {		var thumb_img_width = $('#thumb_holder img:nth-child(2)').outerWidth();		var thumb_margin = parseInt( $('#thumb_holder img:nth-child(2)').css('marginLeft'), 10 );		var thumb_slide_distance = thumb_img_width + thumb_margin;		thumb_timer = setInterval(function(){			//console.log('slide thumbs left');			thumb_holder_position = parseFloat( thumb_holder.css('left') );			console.log('thumbholder: ' + thumb_holder_position );			if ( thumb_holder_position >= 0) {				//move first slide to the end				$('#thumb_holder').prepend( $('#thumb_holder img').last() );				$('#thumb_holder').css('left', -thumb_slide_distance + 'px');			}			else {				thumb_holder.css('left', '+=3');			}		}, 30);	}	function thumb_scroll_right() {		var thumb_img_width = $('#thumb_holder img:nth-child(2)').outerWidth();		var thumb_margin = parseInt( $('#thumb_holder img:nth-child(2)').css('marginLeft'), 10 );		var thumb_slide_distance = thumb_img_width + thumb_margin;		thumb_timer = setInterval(function(){			//console.log('slide thumbs right');			thumb_holder_position = parseFloat( thumb_holder.css('left') );			console.log('thumbholder: ' + thumb_holder_position );			if ( thumb_holder_position < -thumb_slide_distance) {				//move first slide to the end				$('#thumb_holder').append( $('#thumb_holder img').first() );				$('#thumb_holder').css('left','-3px');			}			else {				thumb_holder.css('left', '-=3');			}		}, 30);	}	function thumb_stop_scroll() {		clearInterval(thumb_timer);	}	function thumb_slide_left() {		if ( !thumb_sliding ) {			var thumb_holder_position = parseFloat( thumb_holder.css('left') );			var thumb_img_width = $('#thumb_holder img:nth-child(2)').outerWidth();			var thumb_margin = parseInt( $('#thumb_holder img:nth-child(2)').css('marginLeft'), 10 );			var thumb_slide_distance = thumb_img_width + thumb_margin;			thumb_sliding = true;			$( '#thumb_holder img' ).first().clone().appendTo('#thumb_holder');			thumb_holder.animate({ left : (-thumb_slide_distance) + 'px' }, 200, function() {				thumb_sliding = false;				$( '#thumb_holder img' ).first().remove();				thumb_holder.css('left','0');			});		}	}	function thumb_slide_right() {		if ( !thumb_sliding ) {			var thumb_holder_position = parseFloat( thumb_holder.css('left') );			var thumb_img_width = $('#thumb_holder img:nth-child(2)').outerWidth();			var thumb_margin = parseInt( $('#thumb_holder img:nth-child(2)').css('marginLeft'), 10 );			var thumb_slide_distance = thumb_img_width + thumb_margin;			thumb_sliding = true;			$( '#thumb_holder img' ).last().clone().prependTo('#thumb_holder');			thumb_holder.css('left', (-thumb_slide_distance) + 'px' );			thumb_holder.animate({ left : '0px' }, 200, function() {				thumb_sliding = false;				$( '#thumb_holder img' ).last().remove();				thumb_holder.css('left','0');			});		}	}	function check_active_slide() {		$('#thumb_holder .thumb_image').removeClass('active');		var active_slide_number = Math.abs( parseInt( $('#image_holder').css('left'),10 ) / poster_width );		if ( active_slide_number === total_articles ) {			$('#image_holder').css('left','0px');			check_active_slide();			return;		}		$('#thumb_holder .thumb_image[data-position="' + active_slide_number + '"]').addClass('active');	}	function pause_videos() {		$('.video_container').each(function() {			$(this).get(0).pause();		});	}	function add_video_tracking() {		Enabler.loadModule(studio.module.ModuleId.VIDEO, function() {			for (var i=0; i<total_articles; i++) {				if ( json_articles[i].article_type == 'video' ) {					var video_identifier = 'video_' + i;					var video_object = $('#' + video_identifier);					var video_name = json_articles[i].video_name;					//console.log('video_name: ' + video_name);					var enabler_video = document.getElementById('video_' + i);					studio.video.Reporter.attach(video_name, enabler_video);					var tracking_pixel_start = json_articles[i].tracking_pixel_start;					var tracking_pixel_end =  json_articles[i].tracking_pixel_end;					add_video_tracking_pixels(video_object, tracking_pixel_start, tracking_pixel_end);				}			}		});	}	function add_video_tracking_pixels(video_object, tracking_pixel_start, tracking_pixel_end) {		var random_number = Math.floor(Math.random() * 999999999);		video_object.bind('ended', function() {			//console.log('video ended');			//console.log('video state ended: ' + video_object.parent().attr('data-state') );			video_object.siblings('.image_overlay').removeClass('hidden');			video_object.addClass('hidden');			video_object.parent().attr('data-state','stopped');			video_playing = false;		});	}	start_carousel();	add_video_tracking();}collapsed_instances();collapsed_listeners();// EXPAND LISTENERSEnabler.addEventListener(studio.events.StudioEvent.EXPAND_START,function() {	//Creative begins to expand	//console.log('expand starting');	$('#expanded_wrapper').addClass('expanded_background_image');	disable_collapsed_listeners();	Enabler.finishExpand();});Enabler.addEventListener(studio.events.StudioEvent.EXPAND_FINISH, function() {	//Creative finished expanding	//console.log('expand finished');	pushdown_state = 'expanded';	expanded_container.slideDown(1000);});// COLLAPSE LISTENERSEnabler.addEventListener(studio.events.StudioEvent.COLLAPSE_START, function() {	// Add desired collapsing animation	Enabler.finishCollapse();});Enabler.addEventListener(studio.events.StudioEvent.COLLAPSE_FINISH, function() {	// Show collapsed panel	pushdown_state = 'collapsed';	reset_expanded();	expanded_container.hide();});request_articles();if ( false ) {	Enabler.exit('article_01');	Enabler.exit('article_02');	Enabler.exit('article_03');	Enabler.exit('article_04');	Enabler.exit('article_05');	Enabler.exit('article_06');	Enabler.exit('article_07');	Enabler.exit('article_08');	Enabler.exit('article_09');	Enabler.exit('article_10');}