// # Microfiche.js v1.8.0
//
// ## Usage
//
//     $('.my-slideshow').microfiche();
//     $('.my-slideshow').microfiche({ cyclic: true, button: false });
//     $('.my-slideshow').microfiche({ slideByPages: 1 });
//
// ## Options
//
// The following options can be passed the first time `microfiche` is called
// on an element.
//
// ### cyclic
//
// If true, microfiche wraps around at front and beginning of the slideshow.
// This option is false by default.
//
//     $('.my-slideshow').microfiche({ cyclic: true });
//
// ### buttons
//
// If true, microfiche will create previous/next buttons.
// This option is true by default.
//
//     $('.my-slideshow').microfiche({ buttons: false });
//
// ### bullets
//
// If true, microfiche will create bullets for the pages available.
// This option is also true by default.
//
//     $('.my-slideshow').microfiche({ bullets: false });
//
// ## Commands
//
// The following commands can be run on a microfiche'd element at any point,
// including in the first call.
//
// ### slideByPages
//
// Slides `n` screenfuls (negative `n` goes backwards).
//
//     $('.my-slideshow').microfiche({ slideByPages: n });
//
// ### slideToPage
//
// Slides to the `nth` screenful.
//
//     $('.my-slideshow').microfiche({ slideToPage: n });
//
// ### slideToPoint
//
// Slides to point `x` (rounded and constrained appropriately).
//
//     $('.my-slideshow).microfiche({ slideToPoint: x });
//
// ### jumpToPoint
//
// Jumps without animation to point x (again, rounded and constrained).
//
//     $('.my-slideshow').microfiche({ jumpToPoint: x });
//
// ### autoplay
//
// Automatically advances every `n` seconds.
//
//     $('.my-slideshow').microfiche({ autoplay: n });
//
// ### autopause
//
// Automatically pause autoplay when the user hovers over the carousel.
//
//     $('.my-slideshow').microfiche({ autoplay: n, autopause: true });
//
// ### refresh
//
// To refresh an existing Microficheâ€™s controls and content to adjust
// to a new container size, call the `refresh` method.
//
//     $('.my-slideshow').microfiche({ refresh: true });
//
// ### refreshOnResize
//
// Automatically refresh microfiche filmstrip and controls on window 
// resize event. Set `true` to refresh with a 250ms debounce, or specify 
// a custom debounce rate in ms. The default value is false.
//
//    $('.my-slideshow').microfiche({ refreshOnResize: 100 });
//
// ### destroy
//
// Destroys the microfiche instance and clear related events
//
//    $('my-slideshow').microfiche({ destroy: true });
//    // or
//    $('my-slideshow').data('microfiche').destroy();
//
// ### noScrollAlign
//
// Defines left, right, or center filmstrip alignment in the event that
// all items are visible on screen and no scrolling is required.
//
//    $('.my-slideshow').microfiche({ noScrollAlign: 'left' });
//
(function(){window.Microfiche=function(e){return this.initialize(e),this},Microfiche.VERSION="1.8.0",$.extend(Microfiche.prototype,{options:{autoplay:!1,autopause:!1,buttons:!0,bullets:!0,cyclic:!1,keyboard:!1,swipe:!0,clickToAdvance:!1,minDuration:250,duration:500,maxDuration:500,dragThreshold:25,elasticity:.5,swipeThreshold:.125,refreshOnResize:!1,prevButtonLabel:"&larr;",nextButtonLabel:"&rarr;",noScrollAlign:"left"},x:0,initialize:function(e){this.options=$.extend({},this.options,e),this.el=$(e.el),this.initialContents=this.el.contents(),this.el.data("microfiche",this),this.createFilm(),this.createScreen(),this.calibrate();if(this.film.width()<=this.screen.width()){this.noScrollAlign(this.options.noScrollAlign),this.refreshOnResize(this.options.refreshOnResize);return}this.createControls(),this.enableTouch(),this.enableKeyboard(),this.enableClick(),this.prepareCyclic(),this.run(this.options)},createFilm:function(){this.film=$('<div class="microfiche-film">').css({position:"absolute"}),this.el.children().appendTo(this.film).css({"float":"left"}),this.prepareFilm&&this.prepareFilm()},createScreen:function(){this.screen=$('<div class="microfiche-screen">').css({position:"relative",overflow:"hidden"}).appendTo(this.el).append(this.film)},prepareCyclic:function(){if(!this.options.cyclic)return;var e=this.film.clone(),t=this.film.clone(),n=this.film.width();e.prependTo(this.film).css({position:"absolute",left:-n+"px"}),t.appendTo(this.film).css({position:"absolute",left:n+"px"})},calibrate:function(){this.screen.width(1e5);var e=this.film.width(),t=this.film.height();this.film.width(e).height(t),this.screen.width("auto").height(t)},createControls:function(){var e=this;this.controls=$('<span class="microfiche-controls" />').appendTo(this.el),this.controls.on("click","a, button",function(t){e.didClickControl(t)}),this.options.bullets&&this.createBullets(),this.options.buttons&&this.createButtons(),this.updateControls()},createBullets:function(){var e=$('<span class="microfiche-bullets" />').appendTo(this.controls);for(var t=0;t<this.totalPageCount();t++)$("<button>").addClass("microfiche-bullet").attr("data-microfiche-page",t).data("action","slideToPage").data("arguments",[t]).html(t+1).appendTo(e)},createButtons:function(){$("<button>").addClass("microfiche-button microfiche-prev-button").attr("rel","prev").data("action","prev").data("arguments",[]).html(this.options.prevButtonLabel).prependTo(this.controls),$("<button>").addClass("microfiche-button microfiche-next-button").attr("rel","next").data("action","next").data("arguments",[]).html(this.options.nextButtonLabel).appendTo(this.controls)},enableTouch:function(){if(!this.options.swipe)return;var e=this,t=this.touchstart,n=this.touchmove,r=this.touchend;this.touchstart=function(){t.apply(e,arguments)},this.touchmove=function(){n.apply(e,arguments)},this.touchend=function(){r.apply(e,arguments)},this.film.on("touchstart",this.touchstart)},enableKeyboard:function(){if(!this.options.keyboard)return;var e=this;this.screen.attr("data-microfiche-keyboard",!0);var t=this.onkeydown;this.onkeydown=function(){t.apply(e,arguments)},$(document).on("keydown",this.onkeydown)},enableClick:function(){if(!this.options.clickToAdvance)return;var e=this,t=this.onmousedown;this.onmousedown=function(){t.apply(e,arguments)},this.film.on("mousedown",this.onmousedown)},didClickControl:function(e){e.preventDefault();var t=$(e.target),n=t.data("action"),r=t.data("arguments");this[n].apply(this,r)},touchstart:function(e){var t=e.originalEvent.targetTouches;if(!t||t.length>1)return;this.touchState={then:new Date,ox:t[0].pageX,oy:t[0].pageY,isDrag:!1},$(document).on("touchmove",this.touchmove).on("touchend",this.touchend)},touchmove:function(e){var t=e.originalEvent.targetTouches[0],n=t.pageX-this.touchState.ox,r=t.pageY-this.touchState.oy;if(!this.touchState.isDrag){if(Math.abs(r)>=this.options.dragThreshold){this.touchend();return}Math.abs(n)>=this.options.dragThreshold&&(this.touchState.isDrag=!0)}if(this.touchState.isDrag){e.preventDefault();var i=new Date,t=i-this.touchState.then;this.touchState.vx=(n-this.touchState.dx)/t,this.touchState.vy=(r-this.touchState.dy)/t,this.touchState.dx=n,this.touchState.dy=r,this.touchState.then=i,this.touchState.cx=this.x-n;if(!this.options.cyclic){if(this.touchState.cx<this.min()){var s=this.min()-this.touchState.cx;s*=this.options.elasticity,this.touchState.cx=this.min()-s}if(this.touchState.cx>this.max()){var s=this.touchState.cx-this.max();s*=this.options.elasticity,this.touchState.cx=this.max()+s}}this.film.css({WebkitTransition:"none",WebkitTransform:"translate3d("+ -this.touchState.cx+"px, 0px, 0px)"})}},touchend:function(e){$(document).off("touchmove",this.touchmove).off("touchend",this.touchend);if(this.touchState.isDrag){var t=this.touchState.dx,n=this.screenWidth(),r=this.touchState.vx,i=this.options.swipeThreshold;t<=-n*i?this.slideByPages(1,r):t>=n*i?this.slideByPages(-1,r):this.slideByPages(0)}},onkeydown:function(e){if(e.keyCode!==37&&e.keyCode!==39||!this.isCentral("[data-microfiche-keyboard]"))return;e.keyCode===37?this.slideByPages(-1):e.keyCode===39&&this.slideByPages(1)},onmousedown:function(e){this.slideByPages(1)},updateControls:function(){this.options.bullets&&this.updateBullets(),this.options.buttons&&this.updateButtons()},updateBullets:function(){this.controls.find(".microfiche-bullet").removeClass("selected"),this.controls.find('[data-microfiche-page="'+this.currentPageIndex()+'"]').addClass("selected")},updateButtons:function(){if(this.options.cyclic)return;this.controls.find('[rel="prev"]').attr("disabled",this.x<=this.min()),this.controls.find('[rel="next"]').attr("disabled",this.x>=this.max())},round:function(e){var t=this.screenWidth();return Math.round(e/t)*t},constrain:function(e,t,n){return t===undefined&&(t=this.min()),n===undefined&&(n=this.max()),Math.max(t,Math.min(e,n))},roundAndConstrain:function(e,t,n){return this.constrain(this.round(e),t,n)},withinBounds:function(e){return this.min()<=e&&e<=this.max()},min:function(){return 0},max:function(){return this.film.width()-this.screenWidth()},currentPageIndex:function(){return Math.round(this.x/this.screenWidth())},totalPageCount:function(){return Math.ceil(this.film.width()/this.screenWidth())},screenWidth:function(){return this.el.width()},isCentral:function(e){var t=$($(e||".microfiche-screen").sort(function(e,t){return Math.abs(1-($(window).scrollTop()+$(window).height()/2-$(e).height()/2)/$(e).offset().top)-Math.abs(1-($(window).scrollTop()+$(window).height()/2-$(t).height()/2)/$(t).offset().top)})[0]).parent().data("microfiche");return t===this},jump:function(){this.el.trigger("microfiche:willMove"),this.performJump(),this.updateControls(),this.el.trigger("microfiche:didMove")},performJump:function(){this.film.css({left:-this.x})},transition:function(e){var t=this;this.options.cyclic&&this.handleWrappingTransition(),e==null&&(e=this.options.duration);var n=function(){t.afterTransition()};this.el.trigger("microfiche:willMove"),setTimeout(function(){t.performTransition(e,n)})},handleWrappingTransition:function(){this.x>this.max()?(this.x=this.min()-this.screenWidth(),this.touchState&&this.touchState.dx&&(this.x-=this.touchState.dx),this.jump(),this.x=this.min(),this.updateControls()):this.x<this.min()&&(this.x=this.max()+this.screenWidth(),this.touchState&&this.touchState.dx&&(this.x-=this.touchState.dx),this.jump(),this.x=this.max(),this.updateControls())},performTransition:function(e,t){this.film.stop().animate({left:-this.x+"px"},e,t)},afterTransition:function(){delete this.touchState,this.el.trigger("microfiche:didMove")},slideByPages:function(e,t){var n=this.x,r=this.screenWidth();this.x=this.constrain((Math.round(this.x/r)+e)*r),this.options.cyclic&&this.x==n&&(this.x+=e*r);if(t)var i=this.constrain(Math.abs((this.x-n)/t),this.options.minDuration,this.options.maxDuration);else var i=this.options.duration;this.updateControls(),this.transition(i)},slideToPage:function(e){this.x=this.constrain(e*this.screenWidth()),this.updateControls(),this.transition()},slideToPoint:function(e){this.x=this.roundAndConstrain(e),this.updateControls(),this.transition()},jumpToPage:function(e){this.x=this.constrain(e*this.screenWidth()),this.updateControls(),this.jump()},jumpToPoint:function(e){this.x=this.roundAndConstrain(e),this.updateControls(),this.jump()},prev:function(){this.slideByPages(-1)},next:function(){this.slideByPages(1)},autoplay:function(e){this.autoplayTimeout&&(clearInterval(this.autoplayTimeout),delete this.autoplayTimeout),e=+e;if(isNaN(e)||e<=0)return;var t=this;this.autoplayTimeout=setInterval(function(){t.pause||t.next()},e*1e3)},autopause:function(){var e=this;this.el.hover(function(){e.pause=!0},function(){e.pause=!1})},destroy:function(){this.el.empty(),this.el.off(),this.clearResizeHandler(),this.el.removeData("microfiche")},refresh:function(){var e=this.el.data("microfiche").options,t=this.getContents();return this.destroy(),this.el.append(t),new Microfiche($.extend({el:this.el},e)),this.el},getContents:function(){return this.contentsChanged()?this.el.html():this.el.data("microfiche").initialContents},contentsChanged:function(){return this.el.find(".microfiche-screen").length===0},refreshOnResize:function(e){this.options.refreshOnResize=e,this.resizeHandler&&this.clearResizeHandler();if(e===!1)return;e===!0&&(e=250);var t=this,n;t.resizeHandler=function(){n&&clearTimeout(n),n=setTimeout(function(){t.refresh()},e)},$(window).on("resize",t.resizeHandler)},clearResizeHandler:function(){$(window).off("resize",this.resizeHandler)},noScrollAlign:function(e){if(this.film.width()>this.screen.width())return;switch(e){case"center":this.film.css({left:"50%",marginLeft:this.film.width()/2*-1+"px",right:"auto"});break;case"right":this.film.css({left:"auto",marginLeft:"auto",right:0});break;default:this.film.css({left:0,marginLeft:"auto",right:"auto"})}},run:function(e){for(var t in e){var n=this[t];$.isFunction(n)&&n.call(this,e[t])}}}),"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix&&$.extend(Microfiche.prototype,{prepareFilm:function(){this.film.css({WebkitTransform:"translate3d(0px, 0px, 0px)"})},performTransition:function(e,t){this.film.one("webkitTransitionEnd",t).css({WebkitTransition:"-webkit-transform "+e+"ms",WebkitTransform:"translate3d("+ -this.x+"px, 0px, 0px)"})},performJump:function(){this.film.css({WebkitTransition:"-webkit-transform 0ms",WebkitTransform:"translate3d("+ -this.x+"px, 0px, 0px)"})}}),jQuery.fn.microfiche=function(e){return this.each(function(){var t=$(this).data("microfiche");t?t.run(e):new Microfiche($.extend({el:this},e))})}})(),function(e){e.InFieldLabels=function(t,n,r){var i=this;i.$label=e(t),i.label=t,i.$field=e(n),i.field=n,i.$label.data("InFieldLabels",i),i.showing=!0,i.init=function(){i.options=e.extend({},e.InFieldLabels.defaultOptions,r),i.$field.val()!==""&&(i.$label.hide(),i.showing=!1),i.$field.focus(function(){i.fadeOnFocus()}).blur(function(){i.checkForEmpty(!0)}).bind("keydown.infieldlabel",function(e){i.hideOnChange(e)}).bind("paste",function(){i.setOpacity(0)}).change(function(){i.checkForEmpty()}).bind("onPropertyChange",function(){i.checkForEmpty()})},i.fadeOnFocus=function(){i.showing&&i.setOpacity(i.options.fadeOpacity)},i.setOpacity=function(e){i.$label.stop().animate({opacity:e},i.options.fadeDuration),i.showing=e>0},i.checkForEmpty=function(e){i.$field.val()===""?(i.prepForShow(),i.setOpacity(e?1:i.options.fadeOpacity)):i.setOpacity(0)},i.prepForShow=function(){i.showing||(i.$label.css({opacity:0}).show(),i.$field.bind("keydown.infieldlabel",function(e){i.hideOnChange(e)}))},i.hideOnChange=function(e){e.keyCode!==16&&e.keyCode!==9&&(i.showing&&(i.$label.hide(),i.showing=!1),i.$field.unbind("keydown.infieldlabel"))},i.init()},e.InFieldLabels.defaultOptions={fadeOpacity:.5,fadeDuration:300},e.fn.inFieldLabels=function(t){return this.each(function(){var n=e(this).attr("for");n&&(n=e("input#"+n+"[type='text'],input#"+n+"[type='search'],input#"+n+"[type='tel'],input#"+n+"[type='url'],input#"+n+"[type='email'],input#"+n+"[type='password'],textarea#"+n),n.length!==0&&new e.InFieldLabels(this,n[0],t))})}}(jQuery),function(e){function t(){if(!c){c=!0;for(var t in f)e(t).each(function(){var n,r;n=e(this),r=n.data("jqae"),(r.containerWidth!=n.width()||r.containerHeight!=n.height())&&a(n,f[t])});c=!1}}function n(e){f[e]&&(delete f[e],f.length||l&&(window.clearInterval(l),l=undefined))}function r(e,n){f[e]=n,l||(l=window.setInterval(function(){t()},200))}function i(){return this.nodeType===3}function s(t){if(t.contents().length){var n=t.contents(),r=n.eq(n.length-1);if(r.filter(i).length){var o=r.get(0).nodeValue;return o=e.trim(o),o==""?(r.remove(),!0):!1}while(s(r));return r.contents().length?!1:(r.remove(),!0)}return!1}function o(e){if(e.contents().length){var t=e.contents(),n=t.eq(t.length-1);return n.filter(i).length?n:o(n)}e.append("");var t=e.contents();return t.eq(t.length-1)}function u(t){var n=o(t);if(n.length){var r=n.get(0).nodeValue,i=r.lastIndexOf(" ");return i>-1?(r=e.trim(r.substring(0,i)),n.get(0).nodeValue=r):n.get(0).nodeValue="",!0}return!1}function a(t,n){var r=t.data("jqae");r||(r={});var i=r.wrapperElement;i||(i=t.wrapInner("<div/>").find(">div"));var a=i.data("jqae");a||(a={});var f=a.originalContent;f?i=a.originalContent.clone(!0).data("jqae",{originalContent:f}).replaceAll(i):i.data("jqae",{originalContent:i.clone(!0)}),t.data("jqae",{wrapperElement:i,containerWidth:t.width(),containerHeight:t.height()});var l=t.height(),c=parseInt(t.css("padding-top"),10)+parseInt(t.css("border-top-width"),10)-(i.offset().top-t.offset().top),h=!1,p=i;n.selector&&(p=e(i.find(n.selector).get().reverse())),p.each(function(){var t=e(this),r=t.text(),a=!1;if(i.innerHeight()-t.innerHeight()>l+c)t.remove();else{s(t);if(t.contents().length){h&&(o(t).get(0).nodeValue+=n.ellipsis,h=!1);while(i.innerHeight()>l+c){a=u(t);if(!a){h=!0,t.remove();break}s(t);if(!t.contents().length){h=!0,t.remove();break}o(t).get(0).nodeValue+=n.ellipsis}n.setTitle=="onEllipsis"&&a||n.setTitle=="always"?t.attr("title",r):n.setTitle!="never"&&t.removeAttr("title")}}})}var f={},l,c=!1,h={ellipsis:"...",setTitle:"never",live:!1};e.fn.ellipsis=function(t,i){var s,o;return s=e(this),typeof t!="string"&&(i=t,t=undefined),o=e.extend({},h,i),o.selector=t,s.each(function(){var t=e(this);a(t,o)}),o.live?r(s.selector,o):n(s.selector),this}}(jQuery),function(e,t){function n(e,t){this._d=e,this._isUTC=!!t}function r(e,t){var n=e+"";while(n.length<t)n="0"+n;return n}function i(t,n,r,i){var s=typeof n=="string",o=s?{}:n,u,a,f,l;return s&&i&&(o[n]=+i),u=(o.ms||o.milliseconds||0)+(o.s||o.seconds||0)*1e3+(o.m||o.minutes||0)*6e4+(o.h||o.hours||0)*36e5,a=(o.d||o.days||0)+(o.w||o.weeks||0)*7,f=(o.M||o.months||0)+(o.y||o.years||0)*12,u&&t.setTime(+t+u*r),a&&t.setDate(t.getDate()+a*r),f&&(l=t.getDate(),t.setDate(1),t.setMonth(t.getMonth()+f*r),t.setDate(Math.min((new e(t.getFullYear(),t.getMonth()+1,0)).getDate(),l))),t}function s(e){return Object.prototype.toString.call(e)==="[object Array]"}function o(t){return new e(t[0],t[1]||0,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0)}function u(t,n){function i(n){var g,y;switch(n){case"M":return s+1;case"Mo":return s+1+d(s+1);case"MM":return r(s+1,2);case"MMM":return v.monthsShort[s];case"MMMM":return v.months[s];case"D":return o;case"Do":return o+d(o);case"DD":return r(o,2);case"DDD":return g=new e(a,s,o),y=new e(a,0,1),~~((g-y)/864e5+1.5);case"DDDo":return g=i("DDD"),g+d(g);case"DDDD":return r(i("DDD"),3);case"d":return f;case"do":return f+d(f);case"ddd":return v.weekdaysShort[f];case"dddd":return v.weekdays[f];case"w":return g=new e(a,s,o-f+5),y=new e(g.getFullYear(),0,4),~~((g-y)/864e5/7+1.5);case"wo":return g=i("w"),g+d(g);case"ww":return r(i("w"),2);case"YY":return r(a%100,2);case"YYYY":return a;case"a":return l>11?m.pm:m.am;case"A":return l>11?m.PM:m.AM;case"H":return l;case"HH":return r(l,2);case"h":return l%12||12;case"hh":return r(l%12||12,2);case"m":return c;case"mm":return r(c,2);case"s":return h;case"ss":return r(h,2);case"zz":case"z":return(t._d.toString().match(T)||[""])[0].replace(x,"");case"Z":return(p<0?"-":"+")+r(~~(Math.abs(p)/60),2)+":"+r(~~(Math.abs(p)%60),2);case"ZZ":return(p<0?"-":"+")+r(~~(10*Math.abs(p)/6),4);case"L":case"LL":case"LLL":case"LLLL":case"LT":return u(t,v.longDateFormat[n]);default:return n.replace(/(^\[)|(\\)|\]$/g,"")}}var s=t.month(),o=t.date(),a=t.year(),f=t.day(),l=t.hours(),c=t.minutes(),h=t.seconds(),p=-t.zone(),d=v.ordinal,m=v.meridiem;return n.replace(S,i)}function a(t,n){function r(e,t){var n;switch(e){case"M":case"MM":i[1]=~~t-1;break;case"MMM":case"MMMM":for(n=0;n<12;n++)if(v.monthsParse[n].test(t)){i[1]=n;break}break;case"D":case"DD":case"DDD":case"DDDD":i[2]=~~t;break;case"YY":t=~~t,i[0]=t+(t>70?1900:2e3);break;case"YYYY":i[0]=~~Math.abs(t);break;case"a":case"A":p=t.toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":i[3]=~~t;break;case"m":case"mm":i[4]=~~t;break;case"s":case"ss":i[5]=~~t;break;case"Z":case"ZZ":a=!0,n=(t||"").match(O),n&&n[1]&&(s=~~n[1]),n&&n[2]&&(u=~~n[2]),n&&n[0]==="+"&&(s=-s,u=-u)}}var i=[0,0,1,0,0,0,0],s=0,u=0,a=!1,f=t.match(C),l=n.match(N),c=Math.min(f.length,l.length),h,p;for(h=0;h<c;h++)r(l[h],f[h]);return p&&i[3]<12&&(i[3]+=12),p===!1&&i[3]===12&&(i[3]=0),i[3]+=s,i[4]+=u,a?new e(e.UTC.apply({},i)):o(i)}function f(e,t){var n=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),i=0,s;for(s=0;s<n;s++)~~e[s]!==~~t[s]&&i++;return i+r}function l(e,t){var r,i=e.match(C),s=[],o=99,l,c,h;for(l=0;l<t.length;l++)c=a(e,t[l]),h=f(i,u(new n(c),t[l]).match(C)),h<o&&(o=h,r=c);return r}function c(t){var n="YYYY-MM-DDT",r;if(k.exec(t)){for(r=0;r<3;r++)if(A[r][1].exec(t)){n+=A[r][0];break}return a(t,n+"Z")}return new e(t)}function h(e,t,n){var r=v.relativeTime[e];return typeof r=="function"?r(t||1,!!n,e):r.replace(/%d/i,t||1)}function p(e,t){var n=m(Math.abs(e)/1e3),r=m(n/60),i=m(r/60),s=m(i/24),o=m(s/365),u=n<45&&["s",n]||r===1&&["m"]||r<45&&["mm",r]||i===1&&["h"]||i<22&&["hh",i]||s===1&&["d"]||s<=25&&["dd",s]||s<=45&&["M"]||s<345&&["MM",m(s/30)]||o===1&&["y"]||["yy",o];return u[2]=t,h.apply({},u)}function d(e,t){v.fn[e]=function(e){var n=this._isUTC?"UTC":"";return e!=null?(this._d["set"+n+t](e),this):this._d["get"+n+t]()}}var v,m=Math.round,g={},y=typeof module!="undefined",b="months|monthsShort|monthsParse|weekdays|weekdaysShort|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),w,E=/^\/?Date\((\-?\d+)/i,S=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|dddd?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|zz?|ZZ?|LT|LL?L?L?)/g,x=/[^A-Z]/g,T=/\([A-Za-z ]+\)|:[0-9]{2} [A-Z]{3} /g,N=/(\\)?(MM?M?M?|dd?d?d|DD?D?D?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|ZZ?|T)/g,C=/(\\)?([0-9]+|([a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+|([\+\-]\d\d:?\d\d))/gi,k=/\d{4}.\d\d.\d\d(T(\d\d(.\d\d(.\d\d)?)?)?([\+\-]\d\d:?\d\d)?)?/,L="YYYY-MM-DDTHH:mm:ssZ",A=[["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],O=/([\+\-]|\d\d)/gi,M="1.5.0",_="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|");v=function(r,i){if(r===null||r==="")return null;var u,f;return r&&r._d instanceof e?u=new e(+r._d):i?s(i)?u=l(r,i):u=a(r,i):(f=E.exec(r),u=r===t?new e:f?new e(+f[1]):r instanceof e?r:s(r)?o(r):typeof r=="string"?c(r):new e(r)),new n(u)},v.utc=function(t,r){return s(t)?new n(new e(e.UTC.apply({},t)),!0):r&&t?v(t+" 0",r+" Z").utc():v(t).utc()},v.humanizeDuration=function(e,t,n){var r=+e,i=v.relativeTime,s;switch(t){case"seconds":r*=1e3;break;case"minutes":r*=6e4;break;case"hours":r*=36e5;break;case"days":r*=864e5;break;case"weeks":r*=6048e5;break;case"months":r*=2592e6;break;case"years":r*=31536e6;break;default:n=!!t}return s=p(r,!n),n?(r<=0?i.past:i.future).replace(/%s/i,s):s},v.version=M,v.defaultFormat=L,v.lang=function(e,t){var n,r,i,s=[];if(t){for(n=0;n<12;n++)s[n]=new RegExp("^"+t.months[n]+"|^"+t.monthsShort[n].replace(".",""),"i");t.monthsParse=t.monthsParse||s,g[e]=t}if(g[e])for(n=0;n<b.length;n++)r=b[n],v[r]=g[e][r]||v[r];else y&&(i=require("./lang/"+e),v.lang(e,i))},v.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:{AM:"AM",am:"am",PM:"PM",pm:"pm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10;return~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th"}}),v.isMoment=function(e){return e instanceof n},v.fn=n.prototype={clone:function(){return v(this)},valueOf:function(){return+this._d},"native":function(){return this._d},toString:function(){return this._d.toString()},toDate:function(){return this._d},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(e){return u(this,e?e:v.defaultFormat)},add:function(e,t){return this._d=i(this._d,e,1,t),this},subtract:function(e,t){return this._d=i(this._d,e,-1,t),this},diff:function(e,t,n){var r=v(e),i=(this.zone()-r.zone())*6e4,s=this._d-r._d-i,o=this.year()-r.year(),u=this.month()-r.month(),a=this.date()-r.date(),f;return t==="months"?f=o*12+u+a/30:t==="years"?f=o+u/12:f=t==="seconds"?s/1e3:t==="minutes"?s/6e4:t==="hours"?s/36e5:t==="days"?s/864e5:t==="weeks"?s/6048e5:s,n?f:m(f)},from:function(e,t){return v.humanizeDuration(this.diff(e),!t)},fromNow:function(e){return this.from(v(),e)},calendar:function(){var e=this.diff(v().sod(),"days",!0),t=v.calendar,n=t.sameElse,r=e<-6?n:e<-1?t.lastWeek:e<0?t.lastDay:e<1?t.sameDay:e<2?t.nextDay:e<7?t.nextWeek:n;return this.format(typeof r=="function"?r.apply(this):r)},isLeapYear:function(){var e=this.year();return e%4===0&&e%100!==0||e%400===0},isDST:function(){return this.zone()<v([this.year()]).zone()||this.zone()<v([this.year(),5]).zone()},day:function(e){var t=this._d.getDay();return e==null?t:this.add({d:e-t})},sod:function(){return this.clone().hours(0).minutes(0).seconds(0).milliseconds(0)},eod:function(){return this.sod().add({d:1,ms:-1})},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return this.clone().month(this.month()+1).date(0).date()}};for(w=0;w<_.length;w++)d(_[w].toLowerCase(),_[w]);d("year","FullYear"),y&&(module.exports=v),typeof window!="undefined"&&(window.moment=v),typeof define=="function"&&define.amd&&define("moment",[],function(){return v})}(Date),function(e){"use strict";e.fn.fitVids=function(t){var n={customSelector:null,ignore:null};if(!document.getElementById("fit-vids-style")){var r=document.head||document.getElementsByTagName("head")[0],i=".fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}",s=document.createElement("div");s.innerHTML='<p>x</p><style id="fit-vids-style">'+i+"</style>",r.appendChild(s.childNodes[1])}return t&&e.extend(n,t),this.each(function(){var t=["iframe[src*='player.vimeo.com']","iframe[src*='youtube.com']","iframe[src*='youtube-nocookie.com']","iframe[src*='kickstarter.com'][src*='video.html']","object","embed"];n.customSelector&&t.push(n.customSelector);var r=".fitvidsignore";n.ignore&&(r=r+", "+n.ignore);var i=e(this).find(t.join(","));i=i.not("object object"),i=i.not(r),i.each(function(){var t=e(this);if(t.parents(r).length>0)return;if(this.tagName.toLowerCase()==="embed"&&t.parent("object").length||t.parent(".fluid-width-video-wrapper").length)return;!t.css("height")&&!t.css("width")&&(isNaN(t.attr("height"))||isNaN(t.attr("width")))&&(t.attr("height",9),t.attr("width",16));var n=this.tagName.toLowerCase()==="object"||t.attr("height")&&!isNaN(parseInt(t.attr("height"),10))?parseInt(t.attr("height"),10):t.height(),i=isNaN(parseInt(t.attr("width"),10))?t.width():parseInt(t.attr("width"),10),s=n/i;if(!t.attr("id")){var o="fitvid"+Math.floor(Math.random()*999999);t.attr("id",o)}t.wrap('<div class="fluid-width-video-wrapper"></div>').parent(".fluid-width-video-wrapper").css("padding-top",s*100+"%"),t.removeAttr("height").removeAttr("width")})})}}(window.jQuery||window.Zepto),function(e,t){"use strict";var n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e.fn.imagesLoaded=function(r){function c(){var t=e(f),n=e(l);s&&(l.length?s.reject(u,t,n):s.resolve(u)),e.isFunction(r)&&r.call(i,u,t,n)}function h(e){p(e.target,e.type==="error")}function p(t,r){if(t.src===n||e.inArray(t,a)!==-1)return;a.push(t),r?l.push(t):f.push(t),e.data(t,"imagesLoaded",{isBroken:r,src:t.src}),o&&s.notifyWith(e(t),[r,u,e(f),e(l)]),u.length===a.length&&(setTimeout(c),u.unbind(".imagesLoaded",h))}var i=this,s=e.isFunction(e.Deferred)?e.Deferred():0,o=e.isFunction(s.notify),u=i.find("img").add(i.filter("img")),a=[],f=[],l=[];return e.isPlainObject(r)&&e.each(r,function(e,t){e==="callback"?r=t:s&&s[e](t)}),u.length?u.bind("load.imagesLoaded error.imagesLoaded",h).each(function(r,i){var s=i.src,o=e.data(i,"imagesLoaded");if(o&&o.src===s){p(i,o.isBroken);return}if(i.complete&&i.naturalWidth!==t){p(i,i.naturalWidth===0||i.naturalHeight===0);return}if(i.readyState||i.complete)i.src=n,i.src=s}):c(),s?s.promise(i):i}}(jQuery);var ResponsiveImage=function(e){function i(){var e={width:r.attr("width"),height:r.attr("height"),swap:r.attr("src")};r.css("visibility","hidden").attr({width:r.data("width"),height:r.data("height"),src:r.data("swap")}).data(e).imagesLoaded(function(){r.css("visibility","visible")})}function s(){var e={width:r.attr("width"),height:r.attr("height"),swap:r.attr("src")};r.css("visibility","hidden").attr({width:r.data("width"),height:r.data("height"),src:r.data("swap")}).data(e).imagesLoaded(function(){r.css("visibility","visible")})}var t=$(window).width(),n=e.breakPoint,r=$(e.img);t>n?i():r.imagesLoaded(function(){r.css("visibility","visible")}),$(window).resize(function(){var e=$(window).width();t>=n&&e<n?i():e>=n&&t<n&&s(),t=e})};(function(e){var t={};t.begin=function(){t.externalLinks(),t.relatedCategories(),e(".newsletter_signup label").inFieldLabels(),t.momentiseDates(1),t.pickHighlights(),t.gaTrackedLinks(),t.truncate(),t.authorCount(),t.search(),t.removeDuplicates(),t.responsive()},t.externalLinks=function(){e("body").find('a[href^="http"]:not(a[href^="http://'+document.location.hostname+'"])').each(function(t){var t=e(this);t.attr({target:"_blank"})})},t.momentiseDates=function(n){e(".home-articles, .best-of-the-webs, .most-viewed-articles-slice, .home-top-feature-slice, .regulars-slice, #recent-articles, .recent-articles-slice").find("time").each(function(){var t=e(this),n=t.attr("datetime"),r=moment(n).fromNow(),i=t.parents().is(".recent_list, .most_viewed_list")?"Posted "+r:r;t.text(i)}),n*=2,window.setTimeout(t.momentiseDates,n,n)},t.relatedCategories=function(){var t=e("#related-articles"),n=t.data("number");t.find(".articles-grid").each(function(){var t=e(this).children().get().sort(function(){return Math.round(Math.random())-.5}).slice(n);e(t).remove()})},t.pickHighlights=function(){var t=e(".home_highlights .image");t=e.makeArray(t).sort(function(){return.5-Math.random()});for(var n=0;n<2;n++){var r=e(t.shift()),i=r.attr("data-src");e("<img />",{src:i}).prependTo(r),r.parent().appendTo(".home_highlights .cols")}e(t).parent().remove(),e(".home_highlights").removeClass("hidden")},t.gaTrackedLinks=function(){e(".js-best-of-the-web").each(function(){e(this).click(function(){return _gaq.push(["_trackEvent","BOTW","Click",e(this).attr("href")]),_gaq.push(["b._trackEvent","BOTW","Click",e(this).attr("href")]),window.open(e(this).attr("href")),!1})}),e(".js-external").each(function(){e(this).click(function(){return _gaq.push(["_trackEvent","External","Click",e(this).attr("href")]),_gaq.push(["b._trackEvent","External","Click",e(this).attr("href")]),window.open(e(this).attr("href")),!1})})},t.truncate=function(){e(window).load(function(){e(".truncate").ellipsis()})},t.authorCount=function(){e(".view-author-articles").each(function(){var t=e(this);t.load(t.attr("href")+" .author-count")})},t.search=function(){e(document).on("click",".search-button",function(t){t.preventDefault(),e(".search-overlay").show(),e("#q").focus()}),e(document).on("click touchend",".search-background",function(t){t.preventDefault(),e(".search-overlay").hide(),e("#q").blur()})},t.removeDuplicates=function(){var t=e(".meta[data-id]").data("id");t&&e('[data-id="'+t+'"]:not(.meta)').remove(),e("[data-limit]").each(function(){var t=e(this).data("limit")-1;e(this).children().filter(":gt("+t+")").remove()})},t.responsive=function(){e(".video").fitVids(),e(".toggle-nav").click(function(){e("#nav").toggle()}),e("img[data-swap]").each(function(){new ResponsiveImage({breakPoint:640,img:this})})},t.lazy=function(){e(".lazy-html").each(function(){e(this).replaceWith(e(this).html())}),e("[data-src]").each(function(){e(this).attr("src",e(this).data("src")).removeAttr("data-src")}),!function(e,t,n){var r,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="//platform.twitter.com/widgets.js",i.parentNode.insertBefore(r,i))}(document,"script","twitter-wjs"),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://apis.google.com/js/plusone.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()},e(t.begin),e(window).load(function(){t.lazy()})})(jQuery);